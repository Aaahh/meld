#!/usr/bin/python

import sys
import os
import subprocess

def getScriptPath():
    return os.path.dirname(os.path.realpath(sys.argv[0]))


arglist = []
for arg in sys.argv[1:]:
    if arg.startswith('--output'):
        filename = arg.split('=')[1]
        newArg = '--output=' + os.path.abspath(filename)
    elif arg.startswith('-'):
        newArg = arg
    else:
        newArg = os.path.abspath(arg)
    arglist.append(newArg)

MELDPATH = getScriptPath() + "/Meld-bin"
APPPATH = os.path.abspath(os.path.join(getScriptPath(), '..'))

environment = dict(os.environ,
  **{ "DYLD_LIBRARY_PATH" : APPPATH+"/Resources/lib:"+ APPPATH+"/Frameworks",
      "LANG": "C"})

p = subprocess.call([MELDPATH] + arglist, env= environment)
